# Web测试界面使用指南

## 🌐 快速开始

### 1. 启动服务
```bash
python app_refactored.py
```

### 2. 打开Web界面
双击打开 `test_web_ui.html` 文件，或者在浏览器中打开：
```
file:///D:/ML_Project/RFUAV-server/test_web_ui.html
```

### 3. 检查连接
页面加载后会自动检查与服务的连接状态。

## 📋 功能说明

### 1️⃣ GPU硬件信息
- **功能**: 查看所有GPU设备的详细信息
- **显示内容**:
  - GPU型号、显存、Compute Capability
  - 当前显存使用情况和利用率
  - 每个GPU上的任务数量
- **操作**: 点击"🔄 刷新GPU信息"按钮

### 2️⃣ 资源使用状态
- **功能**: 实时查看各设备的资源占用
- **显示内容**:
  - 每个设备（cuda:0, cuda:1, cpu等）的当前任务数
  - 训练任务和推理任务分别统计
  - 与最大并发数的对比
- **操作**: 点击"🔄 刷新资源状态"按钮（自动每5秒刷新）

### 3️⃣ 启动训练任务
- **功能**: 快速创建训练任务
- **配置项**:
  - **模型**: 选择预定义的模型（ResNet-18/34/50, ViT, MobileNet等）
  - **设备选择**: 
    - `cuda` - 自动选择最优GPU ⭐推荐
    - `cuda:0` - 指定使用GPU 0
    - `cuda:1` - 指定使用GPU 1
    - `cpu` - 使用CPU
  - **类别数**: 分类任务的类别数量
  - **批次大小**: 训练批次大小
  - **训练轮数**: 总训练轮数
  - **学习率**: 优化器学习率
  - **数据路径**: 训练集、验证集、保存路径
- **操作**: 填写配置后点击"🚀 启动训练"
- **结果**: 显示任务ID、使用的设备、当前状态

### 4️⃣ 启动推理任务
- **功能**: 快速创建推理任务
- **配置项**:
  - **设备选择**: 与训练相同
  - **配置文件路径**: 模型配置YAML文件
  - **模型权重路径**: 训练好的模型权重
  - **数据路径**: 待推理数据
  - **结果保存路径**: 推理结果保存位置
- **操作**: 填写配置后点击"🔍 启动推理"
- **结果**: 显示任务ID、使用的设备、当前状态

### 5️⃣ 任务列表
- **功能**: 查看所有训练和推理任务
- **显示内容**:
  - 任务ID、状态、进度
  - 使用的设备
  - 任务消息
- **状态说明**:
  - `pending` - 等待开始（灰色）
  - `queued` - 排队中（灰色）
  - `running` - 运行中（黄色）
  - `completed` - 已完成（绿色）
  - `failed` - 失败（红色）
- **操作**: 点击"🔄 刷新任务列表"按钮

### 6️⃣ 实时日志
- **功能**: 查看任务的实时运行日志
- **使用方法**:
  1. 在"任务ID"框中输入要查看的任务ID
  2. 点击"📡 连接日志流"
  3. 实时查看日志输出
  4. 任务结束后自动断开，或手动点击"⏹️ 断开连接"
- **日志颜色**:
  - 青色: INFO信息
  - 黄色: WARNING警告
  - 红色: ERROR错误

## 🎯 使用示例

### 示例1: 自动选择GPU训练
1. 打开Web界面
2. 在"启动训练任务"卡片中：
   - 模型: 选择 `resnet18`
   - 设备: 选择 `cuda (自动选择)`
   - 填写数据路径
3. 点击"🚀 启动训练"
4. 复制返回的任务ID
5. 在"实时日志"中粘贴任务ID
6. 点击"📡 连接日志流"查看训练日志

### 示例2: 在不同GPU上训练和推理
1. **启动训练**（GPU 0）:
   - 设备: 选择 `cuda:0`
   - 其他配置保持默认
   - 点击"🚀 启动训练"

2. **启动推理**（GPU 1）:
   - 设备: 选择 `cuda:1`
   - 填写配置和权重路径
   - 点击"🔍 启动推理"

3. **查看资源**:
   - 点击"🔄 刷新资源状态"
   - 观察GPU 0和GPU 1的任务分配

### 示例3: 监控GPU使用
1. 点击"🔄 刷新GPU信息"
2. 查看每个GPU的：
   - 显存使用情况
   - 利用率百分比
   - 当前运行的任务数
3. 页面会自动每5秒刷新资源状态

## 🎨 界面说明

### 颜色编码
- **紫色渐变**: 主要按钮和标题
- **绿色**: 成功状态、已完成
- **黄色**: 运行中
- **红色**: 失败、错误
- **蓝色**: 信息、刷新按钮

### 卡片布局
- **响应式设计**: 自动适应屏幕大小
- **网格布局**: 功能模块清晰分离
- **滚动容器**: 任务列表和日志支持滚动查看

## ⚠️ 注意事项

### 1. 服务必须先启动
确保已运行:
```bash
python app_refactored.py
```

### 2. CORS跨域
如果遇到跨域问题，服务已配置允许所有源访问（开发环境）。

### 3. 路径问题
- 填写的路径必须是服务器上的实际路径
- 相对路径基于服务器工作目录
- 如果路径不存在，任务会失败

### 4. 实时刷新
- 资源状态每5秒自动刷新
- 其他信息需手动点击刷新按钮
- 日志流会自动接收更新

### 5. 任务ID
- 任务创建成功后会返回任务ID
- 任务ID会自动填充到日志查看框
- 可以复制任务ID用于后续查询

## 🔧 常见问题

### Q1: 页面显示"无法连接到服务"？
**A**: 
1. 确认服务是否启动：`python app_refactored.py`
2. 检查端口是否为8000
3. 查看浏览器控制台的错误信息

### Q2: GPU信息不显示？
**A**: 
1. 点击"刷新GPU信息"按钮
2. 如果显示"GPU不可用"，表示系统没有GPU或CUDA未安装
3. 可以使用CPU进行训练和推理

### Q3: 任务启动失败？
**A**: 
1. 检查数据路径是否正确
2. 检查是否有足够的资源（GPU/CPU）
3. 查看任务列表中的错误信息
4. 连接日志流查看详细错误

### Q4: 日志流连接失败？
**A**: 
1. 确认任务ID正确
2. 检查任务是否存在（在任务列表中查找）
3. 如果任务已完成，日志流会自动断开

### Q5: 设备选择不生效？
**A**: 
1. 确认选择的设备存在（通过GPU信息查看）
2. 如果选择cuda:1但只有一个GPU，会报错
3. 使用`cuda`自动选择是最保险的方式

## 💡 使用技巧

### 技巧1: 快速测试
1. 使用默认配置快速启动任务
2. 观察任务状态变化
3. 验证GPU选择是否正确

### 技巧2: 并行测试
1. 同时启动多个任务
2. 观察系统如何分配GPU
3. 监控资源使用情况

### 技巧3: 日志监控
1. 训练任务启动后立即连接日志
2. 实时观察训练进度
3. 及时发现问题

### 技巧4: 资源优化
1. 定期查看GPU使用率
2. 根据使用情况调整并发数
3. 合理分配训练和推理任务

## 📱 浏览器兼容性

支持的浏览器：
- ✅ Chrome/Edge (推荐)
- ✅ Firefox
- ✅ Safari
- ⚠️ IE 不支持（需要现代浏览器）

## 🎓 进阶使用

### 自定义样式
可以修改HTML文件中的CSS样式自定义界面外观。

### 添加新功能
可以在JavaScript部分添加新的API调用和功能。

### 批量操作
可以扩展脚本支持批量启动任务、批量取消等操作。

## 📚 相关文档

- [GPU设备选择指南](GPU_SELECTION_GUIDE.md) - 详细的GPU使用说明
- [API路由表](API_ROUTES_TABLE.md) - 完整的API文档
- [快速开始](QUICK_START_REFACTORED.md) - 项目快速开始

## 🙋 获取帮助

如有问题：
1. 查看浏览器控制台错误信息（F12）
2. 查看服务器日志输出
3. 阅读相关文档
4. 检查API端点是否正常工作

---

**祝您测试愉快！** 🎉

如有建议或问题，欢迎反馈。

